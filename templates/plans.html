<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Plans</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Add some specific styles for this page */
        .plan-list-item {
            background-color: #f7f8fa;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: left;
        }
        .plan-list-item h3 {
            margin: 0 0 10px;
        }
        a {
            text-decoration: none;
            color: #1877f2;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíæ Saved Plans</h1>
        <p>Here is a list of all the plans you've generated.</p>
        <div id="plan-list">
            {% for plan in plans %}
                <div class="plan-list-item">
                    <h3>{{ plan.project_name }}</h3>
                    <div class="meta">
                        <strong>ID:</strong> {{ plan.id }} | <strong>Saved on:</strong> {{ plan.created_at }}
                    </div>
                    <div style="margin-top:10px;">
                        <button class="view-plan-btn" data-id="{{ plan.id }}">View</button>
                        <a href="/" style="margin-left:10px;">Create new plan</a>
                    </div>
                </div>
            {% else %}
                <p>No plans have been saved yet.</p>
            {% endfor %}
        </div>
        
        <!-- Modal for showing plan JSON -->
        <div id="plan-modal" class="modal" style="display:none;">
            <div class="modal-content">
                <span id="modal-close" style="float:right;cursor:pointer">&times;</span>
                <h2>Plan Details</h2>
                <pre id="modal-body" style="white-space:pre-wrap;max-height:60vh;overflow:auto;background:#f6f8fa;padding:10px;border-radius:6px;"></pre>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function(){
                const modal = document.getElementById('plan-modal');
                const modalBody = document.getElementById('modal-body');
                const modalClose = document.getElementById('modal-close');

                document.querySelectorAll('.view-plan-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const id = btn.dataset.id;
                        try{
                            const res = await fetch(`/plans/${id}`);
                            if (!res.ok) {
                                const t = await res.text();
                                modalBody.textContent = `Error fetching plan: ${t || res.statusText}`;
                            } else {
                                const data = await res.json();
                                modalBody.textContent = JSON.stringify(data, null, 2);
                            }
                        } catch (e) {
                            modalBody.textContent = 'Fetch error: ' + e.message;
                        }
                        modal.style.display = 'block';
                    });
                });

                modalClose.addEventListener('click', () => modal.style.display = 'none');
                window.addEventListener('click', (ev) => { if (ev.target === modal) modal.style.display = 'none'; });
            });
        </script>
        <br>
        <a href="/">‚Üê Create a New Plan</a>
    </div>
</body>
</html>